---
description: C coding conventions — naming, types, keywords, and macros for based
globs: **/*.h,**/*.c
alwaysApply: false
---

# C Conventions

## Formatting & linting

All code must satisfy `.clang-format` (Chromium-based, 2-space indent, no tabs, no column limit) and `.clang-tidy` (warnings-as-errors). Never manually reformat in a way that contradicts `.clang-format`.

## File structure

Every `.h` and `.c` file opens with the license comment:
```c
// MIT License
// Copyright (c) 2026 Christian Luppi
```

Use `#pragma once` in all headers (never `#ifndef` guards).

Sections within a file are separated by a titled banner:
```c
// =========================================================================
// Section Title
// =========================================================================
```

## Naming

| Kind | Style | Example |
|---|---|---|
| Functions | `lower_case` | `based_add` |
| Variables / parameters | `lower_case` | `byte_count` |
| Global variables | `lower_case` | `global_var i32 counter` |
| Global / enum constants | `UPPER_CASE` | `I32_MAX`, `COLOR_RED` |
| Macros | `UPPER_CASE` | `PLATFORM_WINDOWS` |
| Typedefs / structs / enums | `lower_case` | `vec3`, `color_mode` |

**Never use the `_t` suffix** on any type name. It is reserved by POSIX and must not appear in project-defined types.

All structs and enums must be typedefed so they can be used without the `struct`/`enum` keyword:

```c
// ✅ GOOD
typedef struct vec3 { f32 x, y, z; } vec3;
typedef enum color_mode { COLOR_MODE_RGB, COLOR_MODE_HSV } color_mode;

// ❌ BAD — _t suffix
typedef struct vec3_t { f32 x, y, z; } vec3_t;

// ❌ BAD — no typedef
struct vec3 { f32 x, y, z; };
```

## Primitive Types

Always use project types instead of C standard types:

| Category | Types |
|---|---|
| Signed integers | `i8`, `i16`, `i32`, `i64` |
| Unsigned integers | `u8`, `u16`, `u32`, `u64` |
| Floats | `f32`, `f64` |
| Booleans | `b8`, `b16`, `b32`, `b64` |
| Characters | `c8`, `c16`, `c32` |
| Fast integers | `i8x` … `u64x` |
| Size / pointer | `sz` (`size_t`), `up` (`uintptr_t`), `sp` (`intptr_t`), `dp` (`ptrdiff_t`) |

Min/max constants follow `TYPE_MIN` / `TYPE_MAX` pattern (e.g. `I32_MIN`, `U8_MAX`).

## Custom Keywords

Always use the project's custom keywords — never fall back to raw C equivalents.

```c
read_only global_var i32 MAX_COUNT = 1024;  // constant global (placed in .rodata)
global_var i32 frame_count;                 // non-const global
local_persist u32 call_count = 0;           // static local (persists across calls)
func i32 compute(i32 x);                    // plain function (static if ALL_FUNCS_STATIC)
force_inline i32 fast_abs(i32 x);           // always-inlined function
no_inline void slow_path(void);             // never-inlined function
no_return void fatal(c8 *msg);              // function that never returns
```

All functions must be declared with `func` (or `force_inline` / `no_inline` / `no_return` when appropriate). Never write a bare return-type without one of these qualifiers.

## Function naming — type-prefixed API

Functions that operate on a type must be prefixed with that type's name, forming a `type_verb` or `type_verb_noun` pattern:

```c
// ✅ GOOD
typedef void* mutex;

func mutex mutex_create();
func b32    mutex_destroy(mutex m);
func b32    mutex_is_valid(mutex m);
func void   mutex_lock(mutex m);
func void   mutex_unlock(mutex m);

// ❌ BAD — no type prefix
func mutex create_mutex();
func void  lock(mutex m);
```

The first parameter is conventionally the instance the function acts on. Single-line doc comments above each declaration describe its contract.

## Utility Macros

```c
countof(arr)                    // element count of a fixed-size array
bit(n)  bit_is_set(bits, b)     // bit manipulation
swap(type, a, b)                // in-place swap
in_range(x, lo, hi)            // bounds check
align_up(x, n)  align_down(x, n)  is_pow2(x)
kb(n)  mb(n)  gb(n)  tb(n)     // byte sizes
field_sizeof(T, f)  offset_of(T, f)  container_of(ptr, T, f)
```

## Environment Macros

Use `PLATFORM_*`, `ARCH_*`, `COMPILER_*`, and `BUILD_*` for conditional compilation (defined by `env_defines.h`).

## Header Rules

- Use `#pragma once` (no `#ifndef` guards)
- Include order: project headers first, then system headers
